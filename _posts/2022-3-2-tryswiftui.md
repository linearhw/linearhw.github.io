---
layout: post
title: SwiftUI 체험기 (시리즈도 이미지 공유하고 싶어)
---

<img src="https://user-images.githubusercontent.com/8778711/156376625-1d65fd8b-a801-4409-9f75-5c1feff62d9b.JPG" width="300" />

## "이미지로 멋지게 공유하기" 기능이 탐났다

- 리디북스/카카오페이지/네이버시리즈 세 서비스에 골고루 돈을 쓰는 웹소설 덕후로서 제일 애정하는 앱을 꼽으라면 망설임 없이 리디북스다. 전자책 사업으로 스타트를 끊었던 회사답게 뷰어 스펙이 훌륭하기 그지없다. 카카오페이지는 말이 소설이지 실제 구현은 이미지로 되어 있어서 폰트 크기나 컬러를 커스텀으로 바꿀 수 없고, 네이버시리즈는 소설 읽다가 앱을 백그라운드로 내린 다음 다시 진입하면 화면 전체가 깜빡인다. 어디 그뿐인가. 가로모드도 안 된다. 카카오페이지는 가로모드가 되지만 이미지가 더 큼직해질 뿐 두 쪽 보기는 할 수 없다. 가로모드에서 두 쪽 보기를 할 수 있고, 문장별로 메모나 북마크를 남길 수 있고, TTS 도 제공하는 곳은 리디북스 하나 뿐이다.
- 거기에 플러스 알파, 리디북스를 애정하는 한 가지 이유가 더 있는데 바로 "이미지로 멋지게 공유하기" 기능이 있다는 점이다. 가끔 웹소설 읽다가 마음에 드는 ~~덕심이 벅차오르는~~ 문장을 만나면 문구만 똑 떼서 SNS 에 올리고 싶다. 여러분 이거 봐요 이 작품 정말 재밌어요 제발 나랑 같이 봐줘! 하지만 웹소설 서비스들은 (당연히) 텍스트 복사 기능을 제공하지 않는다. 그랬다간 불법 텍본 만들라고 등 떠미는 꼴이겠지. 하지만 나는 불법 텍본을 만들려는 것이 아니고, 어디까지나 스포일러가 되지 않는 선에서 이 작품을 영업하고 내 감동의 눈물을 공유하고 싶을 뿐이다. 그리고 리디북스는 세 서비스 중 유일하게 이런 '작품 영업'의 니즈를 캐치한다.
- 리디북스의 "이미지로 멋지게 공유하기" 기능을 사용하면 보라색 그라데이션이 들어간 배경에 (물론 배경도 커스텀 할 수 있다) 내가 선택한 문장, 작품의 제목과 작가 이름까지 넣어서 근사한 이미지를 만들 수 있다. 우측 하단에는 리디 로고가 박혀있고, 트위터 타임라인에서 이 보라색 컬러만 봐도 '또 누군가가 리디에서 눈물 좀 흘렸구나' 싶을 정도로 모두에게 알려진 기능이다. 왜 타 서비스는 이런 기능을 만들지 않을까? 요즘 카카오페이지/네이버시리즈 에서도 재밌게 읽고 있는 소설들이 많은데, 친구한테 영업하고 싶으면 스크린 캡처를 해야 하고 캡처를 하면 "스크린샷을 온/오프라인에 유통/공유할 경우 법적인 제재를 받을 수 있다" 는 경고 팝업이 뜬다. 글쎄 그거 아니라구요!

## 목마른 사람이 우물 파야지

- 마음 같아선 시리즈 팀으로 옮겨서 공유 기능만 딱 만들고 돌아오고 싶다. 오픈소스 기여라도 열어주면 내 취미 시간 할애해서라도 만들 의사가 있다. 그 정도로 내겐 이 기능이 중요한데, 손 놓고 기다린다고 기능이 생길 거 같진 않아서 내가 우물을 파기로 했다. 짜가-리디북스-이미지를 만들어주는 앱을 만들면 되지! 
- 리디북스의 "이미지로 멋지게 공유하기" 기능은 문장만 드래그하면 나머지 요소는 앱이 알아서 채워주지만 내 앱은 그럴 수 없다. 공유하고 싶은 문장과 그 출처, 작가 이름까지 모두 직접 써넣어야 한다는 슬픈 단점이 있다. 더군다나 나는 디자인 감각이 영 젬병이라, 디자이너의 도움 없이는 예쁜 디자인을 만들 수 없었다. 덕분에 만들어진 앱은 심플하기 그지없다. 하지만 뭐, 결과로 나온 이미지만 예쁘면 됐지. 이제 시리즈로도 리디북스 흉내낼 수 있어! 나는 그걸로 만족했다.
- 원래 쓰는 Swift 와 UIKit 스킬셋이면 두 시간 이내에 만들 수 있는 앱이었다. 하지만 기껏 손 대는데 그래도 신기술 써봐야지 싶어서 SwiftUI 를 써 봤고 덕분에 이틀 걸렸다. SwiftUI 가 처음 출시됐을 때 튜토리얼 체험까진 했었는데, 내가 직접 화면 구상해서 목표에 맞게 써 본 건 처음이었다.

## SwiftUI 체험 후기
- SwiftUI 가 처음 출시된 게 2019년 9월이니까 2.5년이 지났는데 아직 UIKit 대응이 덜 끝났다.
  -  이번에 만든 앱에선 사용자가 직접 여러 줄의 문장을 입력할 수 있어야 했다. 기존 UIKit 에서 이 기능은 `UITextView` 가 제공했다. SwiftUI 에서 이 `UITextView` 기능을 쓰려면 사용자가 직접 커스텀 클래스를 만들어 써야 했다가, 2020년 9월 iOS 14 가 출시되면서 `TextEditor` 라는  SwiftUI 기본 클래스가 추가됐다.
  - 그런데 이 `TextEditor` 가 `UITextView` 의 기능을 다 갖고 있지 않다. [UITextViewDelegate](https://developer.apple.com/documentation/uikit/uitextviewdelegate) 은 제공하는 함수 종류만 해도 열 개 가까이 되는데, `TextEditor` 에는 오로지 gesture 붙이는 기능만 있다. 취미로 사이드 프로젝트 할 땐 gesture 로도 다 해결할 수 있지만, 실제 서비스 코드는 이걸로 다 커버가 안 될 거 같다는 예감이 강력하게 든다.
  - 예를 들어, 입력한 텍스트 길이에 맞게 UI 높이를 dynamic 으로 조절하는 건 UIKit 에선 그다지 어려운 작업이 아니었다. 하지만 `TextEditor` 에 이런 기능을 붙이려면 PreferenceKey 를 써야 한다. 이런 KVO 스타일의 툴은 최후의 보루에나 쓰는 거 아니었나? 자유도가 높다고 하면 듣기는 좋지만, 이틀간 사용했을 때 내가 받은 인상은 'Native API 개발이 덜 됐다' 였다. 
  - 여전히 UIKit dependency 를 가지고 있다. `TextEditor` 에는 기본 white background 가 들어가 있는데, 여기에 아무리 `.background(Color.red)` 함수를 붙여도 배경은 빨간색이 되지 않는다. 빨간 배경을 만드려면
```swift
struct ContentView: View {
    init() {
        UITextView.appearance().backgroundColor = .clear
    }
    
    var body: some View {
        TextEditor(text: .constant("Placeholder")
            .background(Color.red)
        }
    }
}
``` 
  라고 사전에 clear 세팅을 먼저 해줘야 한다. 아마 큰 규모 서비스로 넘어가면 UIKit dependency 가 더 선명하게 드러나지 않을까.
  
- '애플 스럽지' 않은 UI 를 어떻게든 막으려고 안간힘을 쓴다.
  - 애플의 [디자인 가이드라인](https://developer.apple.com/design/human-interface-guidelines/) 을 전부 지켜가며 앱을 만들 수 있으면 깔끔하고 좋겠지. 하지만 내가 개발해 본 서비스 중 애플의 기본 내비게이션 바를 그대로 사용하는 곳은 어디도 없었다. 커스텀 내비 바를 만들고 싶어하는 디자인 팀의 욕심은 강력하다.
  - 애플에선 한결같이 그러지 좀 말라고 했지만 꾸역꾸역 method override 넣어가며 K-스타일 내비 바를 만들었는데, SwiftUI 에선 그러기가 꽤 힘들어 보인다. frame 에 직접 접근할 수 있었던 UIKit 과 달리 SwiftUI 는 "그리는 건 내가 알아서 할 테니 넌 정보만 맞게 입력해" 라는 기조를 보이기 때문이다. 아마 이거 때문에라도 UIKit 을 마지막까지 못 놓지 않을까.
  
- UI 레이어 디버깅이 힘들다.
  - 위에서 말한 SwiftUI 의 기조는 디버깅을 힘들게 만드는 요소이기도 하다. 일단 frame 정보를 알려면 GeometryReader 라는 별도의 클래스를 써야 하고, 런타임에 `view.frame` 를 찍어보고 싶어서 View 를 구성하는 중간에 
```swift
print(geometry.frame(in: .global))
``` 
  같은 걸 끼워넣으면 이건 View 가 아니라며 컴파일 에러를 띄우기 때문이다. 물론 어디에나 꼼수는 있어서
```swift
let _ = print(geometry.frame(in: .global))
``` 
  로 하면 또 컴파일 에러가 안 난다고 한다.
  하지만 디버깅 툴 중 가장 베이직인 print 를 꼼수까지 써가며 넣어야 한다니? 그냥 좀 쓸 수 있게 해줘...

## 결론

- 이틀간 애플 욕 많이 했고 당분간은 손 안 댈 예정
- GitHub Repo는 [여기](https://github.com/linearhw/BeautifulCapture)
  - 사실 이미지 하단에 네이버시리즈 로고도 박아 넣었는데, 이건 로컬 브랜치에서만 작업하고 일부러 리모트에는 푸시하지 않았다. 왜냐면 이 로고는 시리즈 팀 레포 가서 직접 다운받아 온 찐이라서... public 으론 배포할 수 없다. 
- "어두운 바다의 등불이 되어" 많이많이 사랑해 주세요. 저는 이 소설이 2022 최고의 웹소설이 될 거라 믿어 의심치 않습니다.
